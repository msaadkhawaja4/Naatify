let currentFolder=null,allFolders=[],currentAudio=null,currentIndex=null,naats=[],naatPlayImages=[],naatcarDivs=[],lastPlayedIndex=null;function showCustomAlert(e){const t=document.getElementById("custom-alert"),n=document.getElementById("alert-message"),r=document.getElementById("alert-ok");n.textContent=e,t.style.display="flex",r.onclick=()=>{t.style.display="none"}}function updatePlayButtonImage(){const e=document.getElementById("pbplb");if(!e)return;const t=e.querySelector("img");t&&(!currentAudio||currentAudio.paused?t.src="play-button.png":t.src="pause.png")}function updateFolderCard(){if(document.querySelectorAll(".card-cont .card").forEach(e=>e.classList.remove("playing-folder")),currentFolder&&currentAudio&&!currentAudio.paused){const e=document.querySelector(`.card-cont .card[data-folder="${currentFolder.path}"]`);e&&e.classList.add("playing-folder")}}function updateNaatListImages(){for(let e=0;e<naatPlayImages.length;e++)naatPlayImages[e].src="play-button.png",naatcarDivs[e].classList.remove("playing"),naatcarDivs[e].classList.remove("last-played");if(null!==currentIndex&&!currentAudio.paused){naatPlayImages[currentIndex].src="pause.png",naatcarDivs[currentIndex].classList.add("playing");const e=document.querySelector(".l-b");if(e&&e.scrollHeight>e.clientHeight){const t=naatcarDivs[currentIndex],n=e.getBoundingClientRect(),r=t.getBoundingClientRect().top-n.top,a=e.scrollTop+r-e.clientHeight/2+t.offsetHeight/2;e.scrollTo({top:a,behavior:"smooth"})}return}currentAudio.paused&&null!==lastPlayedIndex&&lastPlayedIndex>=0&&lastPlayedIndex<naatcarDivs.length&&(naatcarDivs[lastPlayedIndex].classList.add("last-played"),naatPlayImages[lastPlayedIndex].src="play-button.png")}function playIndex(e){null==e||e<0||e>=naats.length||(currentAudio.paused||currentAudio.pause(),lastPlayedIndex=null,currentIndex=e,currentAudio.src=naats[currentIndex],currentAudio.currentTime=0,currentAudio.play(),updatePlayButtonImage(),updateNaatListImages(),updateFolderCard())}function stopCurrent(){try{null!==currentIndex&&(currentAudio.pause(),currentAudio.currentTime=0,naatPlayImages[currentIndex].src="play-button.png",naatcarDivs[currentIndex].classList.remove("playing"),lastPlayedIndex=currentIndex),updateNaatListImages(),updateFolderCard()}catch(e){}}async function getFolders(){try{console.log("Fetching folders from API..."),console.log("Current protocol:",window.location.protocol),console.log("Current hostname:",window.location.hostname),console.log("Current port:",window.location.port);const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,t=e?"http://localhost:3001/api/folders":"/api/folders";console.log("isLocalhost:",e),console.log("Using API URL:",t);const n=await fetch(t);if(console.log("Response status:",n.status),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();return console.log("Fetched folders:",r),r}catch(e){return console.error("Error fetching folders:",e),[]}}async function displayFolders(){allFolders=await getFolders();const e=document.querySelector(".card-cont");if(e){e.innerHTML="";for(const t of allFolders){const n=document.createElement("div");n.className="card bbb chover",n.style.cursor="pointer",n.setAttribute("data-folder",t.path),n.innerHTML=`\n            <div class="play-button">\n                <img src="play-button.png" alt="Play">\n            </div>\n            <img class="bb" src="${t.img||"Naatify_logo.png"}" alt="pic">\n            <h2>${t.name}</h2>\n            <p>${t.count} Naat${t.count>1?"s":""}</p>\n        `,n.addEventListener("click",()=>{currentAudio&&!currentAudio.paused&&(currentAudio.pause(),updateFolderCard(),updatePlayButtonImage()),currentFolder=t;loadNaatPlayer(t.files.map(e=>t.path?`Naats/${t.path}/${e}`:`Naats/${e}`))}),e.appendChild(n)}}else console.error("Card container not found")}function loadNaatPlayer(e){console.log("Loading naats:",e);const t=document.querySelector(".l-b ul");if(!t)return void console.error("Could not find the Naats list container (.l-b ul) in the DOM");if(t.innerHTML="",!e||0===e.length){console.warn("No naats found in this folder.");const e=document.createElement("li");return e.textContent="No naats found.",void t.appendChild(e)}naats=e;const n=new Audio;currentAudio=n,currentIndex=null,naatPlayImages=[],naatcarDivs=[],lastPlayedIndex=null;const r=document.querySelector(".naatinfo"),a=document.querySelector(".naattime"),o=(document.querySelector(".seekbar"),document.querySelector(".circle"));function l(e){if(isNaN(e))return"0:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n<10?"0":""}${n}`}function c(){if(!n.duration)return;const e=n.currentTime/n.duration*100;o&&(o.style.left=e+"%")}function s(){if(a){const e=l(n.currentTime),t=l(n.duration);a.textContent=`${e} / ${t}`}}n.addEventListener("loadedmetadata",()=>{s(),r&&null!==currentIndex&&(r.textContent=decodeURIComponent(naats[currentIndex].split("/").pop()).replace(".mp3","")),c()}),n.addEventListener("timeupdate",()=>{c(),s()});for(let e=0;e<naats.length;e++){const n=naats[e],r=document.createElement("div");r.className="naatcar",naatcarDivs.push(r);const a=document.createElement("ul"),o=document.createElement("li"),l=document.createElement("img");l.src="musicnote.png",l.alt="";const c=document.createElement("div");c.className="nn",c.textContent=decodeURIComponent(n.split("/").pop()).replace(".mp3","");const s=document.createElement("div");s.className="ncpb";const d=document.createElement("span");d.textContent="Play";const u=document.createElement("img");u.src="play-button.png",u.alt="",naatPlayImages.push(u),s.appendChild(d),s.appendChild(u),o.appendChild(l),o.appendChild(c),o.appendChild(s),a.appendChild(o),r.appendChild(a),t.appendChild(r),o.style.cursor="pointer",o.addEventListener("click",t=>{playIndex(e)}),u.style.cursor="pointer",u.addEventListener("click",t=>{t.stopPropagation(),currentIndex!==e||currentAudio.paused?playIndex(e):(currentAudio.pause(),lastPlayedIndex=currentIndex,updateNaatListImages(),updateFolderCard()),updatePlayButtonImage()})}}async function main(){await displayFolders(),document.querySelector(".Go-2").addEventListener("click",()=>{document.querySelector(".left").style.left="0"}),document.querySelector(".Go-1").addEventListener("click",()=>{document.querySelector(".left").style.left="-100%"});const e=document.getElementById("pbplb"),t=document.getElementById("pbprb"),n=document.getElementById("pbneb"),r=document.querySelector(".seekbar");e&&e.addEventListener("click",()=>{null!==currentIndex&&(currentAudio.paused?(currentAudio.play(),updateNaatListImages()):(currentAudio.pause(),lastPlayedIndex=currentIndex,updateNaatListImages()),updatePlayButtonImage(),updateFolderCard())}),t&&t.addEventListener("click",()=>{null!==currentIndex&&currentIndex>0&&(stopCurrent(),playIndex(currentIndex-1))}),n&&n.addEventListener("click",()=>{null!==currentIndex&&currentIndex<naats.length-1&&(stopCurrent(),playIndex(currentIndex+1))}),r&&r.addEventListener("click",e=>{if(!currentAudio||!currentAudio.duration)return;const t=r.getBoundingClientRect(),n=(e.clientX-t.left)/t.width;currentAudio.currentTime=n*currentAudio.duration}),document.addEventListener("keydown",e=>{const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||t.classList.contains("search-input")))return;const n=e.code,r=e.key,a=e.keyCode||e.which,o="ArrowLeft"===n||"ArrowLeft"===r||37===a,l="ArrowRight"===n||"ArrowRight"===r||39===a,c="ArrowUp"===n||"ArrowUp"===r||38===a,s="ArrowDown"===n||"ArrowDown"===r||40===a;if("Space"===n||" "===r||"Spacebar"===r||32===a){if(e.preventDefault(),null===currentIndex)return;currentAudio.paused?(currentAudio.play(),updateNaatListImages()):(currentAudio.pause(),lastPlayedIndex=currentIndex,updateNaatListImages()),updatePlayButtonImage(),updateFolderCard()}else if(o){if(e.preventDefault(),null===currentIndex)return;currentIndex>0&&(stopCurrent(),playIndex(currentIndex-1))}else if(l){if(e.preventDefault(),null===currentIndex)return;currentIndex<naats.length-1&&(stopCurrent(),playIndex(currentIndex+1))}else c?(e.preventDefault(),scrollNaatList("up")):s&&(e.preventDefault(),scrollNaatList("down"))});const a=document.querySelector(".sign-up"),o=document.querySelector(".log-in");a&&a.addEventListener("click",()=>{showCustomAlert("Sorry the Sign in service is not available yet")}),o&&o.addEventListener("click",()=>{showCustomAlert("Sorry the Log in service is not available yet")});const l=document.querySelector(".home-icon");l&&l.addEventListener("click",()=>{window.location.reload()});const c=document.querySelector(".search-icon");c&&c.addEventListener("click",()=>{const e=c.querySelector("img"),t=c.querySelector("h3");e&&(e.style.display="none"),t&&(t.style.display="none");const n=document.createElement("input");n.type="text",n.placeholder="Search naats...",n.className="search-input",n.style.width="100%",n.style.padding="8px",n.style.border="1px solid #578bfc",n.style.backgroundColor="#313131ff",n.style.color="white",n.style.outline="none",n.style.borderRadius="4px",n.style.fontSize="14px",c.innerHTML="",c.appendChild(n),n.focus(),n.addEventListener("keypress",e=>{if("Enter"===e.key){const e=n.value.trim().toLowerCase();e&&currentFolder&&naats.length>0&&searchNaat(e),c.innerHTML='\n                        <img src="search.png" alt="Search">\n                        <h3 class="h3">Search</h3>\n                    '}}),n.addEventListener("blur",()=>{setTimeout(()=>{c.innerHTML='\n                        <img src="search.png" alt="Search">\n                        <h3 class="h3">Search</h3>\n                    '},100)})})}function scrollNaatList(e){const t=document.querySelector(".l-b");if(!t)return;const n=t.scrollTop;if("up"===e)t.scrollTo({top:Math.max(0,n-100),behavior:"smooth"});else if("down"===e){const e=t.scrollHeight-t.clientHeight;t.scrollTo({top:Math.min(e,n+100),behavior:"smooth"})}}function searchNaat(e){if(!naats.length)return void showCustomAlert("No naats loaded. Please select a playlist first.");const t=naats.findIndex(t=>decodeURIComponent(t.split("/").pop()).replace(".mp3","").toLowerCase().includes(e));if(-1!==t){const e=naatcarDivs[t];if(e){e.scrollIntoView({behavior:"smooth",block:"center"});const t=e.querySelector("li");t&&(t.style.backgroundColor="#505050ff",t.style.borderColor="#25dff8",setTimeout(()=>{t.style.backgroundColor="",t.style.borderColor="#0051ff"},2e3))}}else showCustomAlert(`The selected playlist does not contain this naat: "${e}"`)}window.addEventListener("pagehide",()=>{currentAudio&&currentAudio.pause()}),window.addEventListener("beforeunload",()=>{currentAudio&&currentAudio.pause()}),main();